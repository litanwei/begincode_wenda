<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="net.begincode.core.mapper.Biz_ProAttentionMapper">
    <resultMap id="BaseResultMap" type="net.begincode.core.model.ProAttention">
        <!-- WARNING - @mbggenerated This element is automatically generated by
            MyBatis Generator, do not modify. -->
        <id column="pro_attention_id" property="proAttentionId" jdbcType="INTEGER"/>
        <result column="vote" property="vote" jdbcType="TINYINT"/>
        <result column="collect" property="collect" jdbcType="TINYINT"/>
        <result column="begincode_user_id" property="begincodeUserId"
                jdbcType="INTEGER"/>
        <result column="problem_id" property="problemId" jdbcType="INTEGER"/>
    </resultMap>
    <select id="statisticsByProblem" resultMap="BaseResultMap">
        SELECT * FROM pro_attention
        <where>
            <if test='_parameter == "v" '>
                vote=1
            </if>
            <if test='_parameter == "c" '>
                collect=1
            </if>
        </where>
    </select>
    <select id="selectByViewCount" parameterType="java.lang.Integer"
            resultType="java.lang.Integer">
		SELECT view_count FROM problem WHERE problem_id=#{problem_id}
	</select>
    <update id="updateByProattention" parameterType="net.begincode.core.model.ProAttention">
		update pro_attention
		set vote = #{vote,jdbcType=TINYINT},
		collect = #{collect,jdbcType=TINYINT}
		WHERE problem_id =#{problemId} AND begincode_user_id=#{begincodeUserId}
	</update>
    <update id="updateByProblemCounts">
		UPDATE problem set view_count=#{views},vote_count=#{votes},collect_count=#{collects} where problem_id=#{problem_id}
	</update>
    <select id="selectCollectNumByUserId" parameterType="java.lang.Integer"
            resultType="java.lang.Integer">
SELECT COUNT(pro_attention.pro_attention_id) FROM problem,pro_attention WHERE pro_attention.begincode_user_id=#{userId} AND pro_attention.collect=1 AND problem.problem_id=pro_attention.problem_id

	</select>
</mapper>